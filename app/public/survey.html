<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>FindAFriend!</title>
    <script
    src="http://code.jquery.com/jquery-3.3.1.min.js"
    integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
    crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.4/css/bootstrap-select.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.4/js/bootstrap-select.min.js"></script>
    <script defer src="https://use.fontawesome.com/releases/v5.0.6/js/all.js"></script>

    <link rel="stylesheet" href="../../style.css">
  </head>
  <body>

    <!-- Match Modal  -->
        <div id="myModal" class="modal">
        <div class="modal-content">
          <div class="modal-header">
            <span class="close">&times;</span>
            <h2>Congratulations! You matched with: </h2>
          </div>
        <div class="userMatch">
        </div>
        <div class="modal-footer">
          <button type="button" class="close">Close</button>
        </div>
      </div>
    </div>

    <!-- Fill Req Fields Modal  -->
        <div id="myModal2" class="modal">
        <div class="modal-content">
          <div class="modal-header">
            <span class="close">&times;</span>
            <h2>Whoops!</h2>
          </div>
        <h3>Please fill out all required fields :)</h3>
        <div class="modal-footer">
          <button type="button" class="close">Close</button>
        </div>
      </div>
    </div>

    <!--Survey Questions -->
    <div class="container">
      <h2>Survey Questions<a href="/"><button type="button" class="btn btn-lg btn-default pull-right">
        <span class = 'glyphicon glyphicon-home'></span>
      </button></a></h2>
      <hr>
      <h3>About You</h3>
      <h4>Name (Required)</h4>
      <div class="form-group">
        <input class="form-control" id="name">
      </div>
      <h3>Photo Link: (Required)</h3>
      <div class="form-group">
        <input class="form-control" id='photo'>
      </div>
     <hr>
     <h3>Question 1</h3>
     <h4>Test Question 1</h4>
     <div class="form-group questions">
       <select class="selectpicker" data-live-search="true" title="Choose one:" id='q1'>
        <option data-tokens="1 Strongly Disagree">1 (Strongly Disagree)</option>
        <option data-tokens="2">2</option>
        <option data-tokens="3">3</option>
        <option data-tokens="4">4</option>
        <option data-tokens="5 Strongly Agree">5 (Strongly Agree)</option>
      </select>
    </div>
     <h3>Question 2</h3>
     <h4>Test Question 2</h4>
     <div class="form-group questions">
       <select class="selectpicker" data-live-search="true" title="Choose one:" id='q2'>
        <option data-tokens="1 Strongly Disagree">1 (Strongly Disagree)</option>
        <option data-tokens="2">2</option>
        <option data-tokens="3">3</option>
        <option data-tokens="4">4</option>
        <option data-tokens="5 Strongly Agree" selected="selected">5 (Strongly Agree)</option>
      </select>
    </div>
     <h3>Question 3</h3>
     <h4>Test Question 3</h4>
     <div class="form-group questions">
       <select class="selectpicker" data-live-search="true" title="Choose one:" id='q3'>
        <option data-tokens="1 Strongly Disagree">1 (Strongly Disagree)</option>
        <option data-tokens="2">2</option>
        <option data-tokens="3" selected="selected">3</option>
        <option data-tokens="4">4</option>
        <option data-tokens="5 Strongly Agree">5 (Strongly Agree)</option>
      </select>
    </div>
     <h3>Question 4</h3>
     <h4>Test Question 4</h4>
     <div class="form-group questions">
       <select class="selectpicker" data-live-search="true" title="Choose one:" id='q4'>
        <option data-tokens="1 Strongly Disagree" selected="selected">1 (Strongly Disagree)</option>
        <option data-tokens="2">2</option>
        <option data-tokens="3">3</option>
        <option data-tokens="4">4</option>
        <option data-tokens="5 Strongly Agree">5 (Strongly Agree)</option>
      </select>
    </div>
     <h3>Question 5</h3>
     <h4>Test Question 5</h4>
     <div class="form-group questions">
       <select class="selectpicker" data-live-search="true" title="Choose one:" id='q5'>
        <option data-tokens="1 Strongly Disagree">1 (Strongly Disagree)</option>
        <option data-tokens="2">2</option>
        <option data-tokens="3">3</option>
        <option data-tokens="4" selected="selected">4</option>
        <option data-tokens="5 Strongly Agree">5 (Strongly Agree)</option>
      </select>
    </div>
     <h3>Question 6</h3>
     <h4>Test Question 6</h4>
     <div class="form-group questions">
       <select class="selectpicker" data-live-search="true" title="Choose one:" id='q6'>
        <option data-tokens="1 Strongly Disagree">1 (Strongly Disagree)</option>
        <option data-tokens="2">2</option>
        <option data-tokens="3">3</option>
        <option data-tokens="4">4</option>
        <option data-tokens="5 Strongly Agree" selected="selected">5 (Strongly Agree)</option>
      </select>
    </div>
     <h3>Question 7</h3>
     <h4>Test Question 7</h4>
     <div class="form-group questions">
       <select class="selectpicker" data-live-search="true" title="Choose one:" id='q7'>
        <option data-tokens="1 Strongly Disagree">1 (Strongly Disagree)</option>
        <option data-tokens="2" selected="selected">2</option>
        <option data-tokens="3">3</option>
        <option data-tokens="4">4</option>
        <option data-tokens="5 Strongly Agree">5 (Strongly Agree)</option>
      </select>
    </div>
     <h3>Question 8</h3>
     <h4>Test Question 8</h4>
     <div class="form-group questions">
       <select class="selectpicker" data-live-search="true" title="Choose one:" id='q8'>
        <option data-tokens="1 Strongly Disagree">1 (Strongly Disagree)</option>
        <option data-tokens="2">2</option>
        <option data-tokens="3" selected="selected">3</option>
        <option data-tokens="4">4</option>
        <option data-tokens="5 Strongly Agree">5 (Strongly Agree)</option>
      </select>
    </div>
     <h3>Question 9</h3>
     <h4>Test Question 9</h4>
     <div class="form-group questions">
       <select class="selectpicker" data-live-search="true" title="Choose one:" id='q9'>
        <option data-tokens="1 Strongly Disagree">1 (Strongly Disagree)</option>
        <option data-tokens="2">2</option>
        <option data-tokens="3">3</option>
        <option data-tokens="4">4</option>
        <option data-tokens="5 Strongly Agree">5 (Strongly Agree)</option>
      </select>
    </div>
     <h3>Question 10</h3>
     <h4>Test Question 10</h4>
     <div class="form-group questions">
       <select class="selectpicker" data-live-search="true" title="Choose one:" id='q10'>
        <option data-tokens="1 Strongly Disagree">1 (Strongly Disagree)</option>
        <option data-tokens="2">2</option>
        <option data-tokens="3">3</option>
        <option data-tokens="4">4</option>
        <option data-tokens="5 Strongly Agree">5 (Strongly Agree)</option>
      </select>
    </div>

     <a href="/survey">
       <button type="submit" class="btn btn-lg btn-primary btn-block">
         <span class="glyphicon glyphicon-envelope"></span> Submit
       </button>
     </a>
     <hr>
     <footer>
       <a href="/api/friends">Friends List API |</a>
       <a href="https://github.com/trobe026/FriendFinder"> GitHub Repo</a>
     </footer>
    </div>
    <script type="text/javascript">

    $(".btn-block").on("click", function(event) {
      event.preventDefault();




      // parse all fields for user responses and sent ajax post request
      var newUser = {
        "name":$("#name").val().trim(),
        "photo":$("#photo").val().trim(),
        "scores" : [
          $("#q1").val().trim().charAt(0),
          $("#q2").val().trim().charAt(0),
          $("#q3").val().trim().charAt(0),
          $("#q4").val().trim().charAt(0),
          $("#q5").val().trim().charAt(0),
          $("#q6").val().trim().charAt(0),
          $("#q7").val().trim().charAt(0),
          $("#q8").val().trim().charAt(0),
          $("#q9").val().trim().charAt(0),
          $("#q10").val().trim().charAt(0)
        ]};

        var missingFields = 0;
        for (var i in newUser) {
          for (var j = 0; j < newUser.scores.length; j++) {
            if (newUser.scores[j] === "") {
              missingFields++;
              } else if (newUser.name === "" || newUser.photo === "") {
                missingFields++;
              }
            }
          }


        if (missingFields === 0) {
          $.post("/api/friends", newUser);
          // run function to grab user's match and display modal
          getMatch();
          var modal = document.getElementById('myModal');
          modal.style.display = "block";

          // close modal on button click
          $(".close").click(function() {
            modal.style.display = "none";
          });

          // When the user clicks anywhere outside of the modal, close it
          window.onclick = function(event) {
              if (event.target == modal) {
                  modal.style.display = "none";
              }
            }
        } else {
          // display modal to fill all req fields
          var modal2 = document.getElementById('myModal2');
          modal2.style.display = "block";

          // close modal on button click
          $(".close").click(function() {
            modal2.style.display = "none";
          });

          // When the user clicks anywhere outside of the modal, close it
          window.onclick = function(event) {
              if (event.target == modal) {
                  modal2.style.display = "none";
              }
            }
        }
// end onclick function
      });

function getMatch() {
  var currentURL = window.location.origin;
  $.ajax({ url: currentURL + "/api/match", method: "GET" })
  .then(function(match) {
  // checks to see if img url for user's match is valid, if not, displays name only
  $.ajax({
      type: 'HEAD',
      url: match[1],
        success: function() {
          $(".userMatch").html(`<h1>${match[0]}</h1><hr><img src=${match[1]}>`);
        },
          error: function() {
          $(".userMatch").html(`<h1>${match[0]}</h1><hr><h2>Sorry, this user does not have a valid photo!</h2>`);
        }
      });
    console.log(match);
  });
}
    </script>
  </body>
</html>
